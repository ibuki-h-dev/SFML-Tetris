name: Build Tetris

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  build:
    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v4

      # 1. vcpkgのキャッシュ設定（2回目以降のビルドが高速になります）
      - name: Cache vcpkg
        uses: actions/cache@v4
        with:
          path: $VCPKG_INSTALLATION_ROOT/installed
          key: vcpkg-${{ runner.os }}-sfml3

      # 2. SFML 3.0 をインストール (GitHubのサーバーには入っていないため必須)
    # 2. SFML 3.0 をインストール (マニフェストモード対応)
      - name: Install SFML via vcpkg
        run: vcpkg install --triplet x64-windows

      # 3. CMake構成
      # Actionsのサーバーは VS2022 なので、明示的に Generator を指定します
      - name: Configure
        run: >
          cmake -S . -B build 
          -G "Visual Studio 17 2022" 
          -A x64
          -DCMAKE_BUILD_TYPE=Release 
          -DCMAKE_TOOLCHAIN_FILE="$VCPKG_INSTALLATION_ROOT/scripts/buildsystems/vcpkg.cmake"

      # 4. ビルド実行
      - name: Build
        run: cmake --build build --config Release

      # 5. 成果物のアップロード (exeとassets)
      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: Tetris-Windows-Package
          path: |
            build/Release/Tetris.exe
            build/Release/assets/